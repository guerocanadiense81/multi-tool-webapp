<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>BTC Wallet Generator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="../css/style.css">

  <!-- ✅ Correct libraries that work in-browser -->
  <script src="https://unpkg.com/bip39@3.0.4/browser/bip39.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bitcoinjs-lib@6.1.0/dist/bitcoinjs-lib.min.js"></script>
</head>
<body>
  <div class="container">
    <h1>₿ BTC Wallet Generator</h1>
    <button class="tool-button" onclick="generateBTC()">Generate Wallet</button>
    <button class="tool-button" id="downloadBtn" style="display:none;" onclick="downloadWallet()">⬇ Download Wallet.txt</button>
    <div id="outputBox" style="margin-top: 20px;"></div>
    <a href="../index.html" class="tool-button" style="margin-top: 30px;">⬅ Back</a>

    <script>
      let latestWallet = null;

      function generateBTC() {
        try {
          const mnemonic = bip39.generateMnemonic(); // ✅ Works now!
          const seed = bip39.mnemonicToSeedSync(mnemonic);
          const root = bitcoinjs.bip32.fromSeed(seed);
          const child = root.derivePath("m/44'/0'/0'/0/0");
          const { address } = bitcoinjs.payments.p2pkh({ pubkey: child.publicKey });
          const wif = child.toWIF();

          latestWallet = { mnemonic, address, wif };

          document.getElementById("outputBox").innerHTML = `
            <p><strong>Mnemonic:</strong><br><textarea rows="2" readonly>${mnemonic}</textarea></p>
            <p><strong>BTC Address:</strong><br><code>${address}</code></p>
            <p><strong>Private Key (WIF):</strong><br><code>${wif}</code></p>
          `;
          document.getElementById("downloadBtn").style.display = "inline-block";
        } catch (err) {
          document.getElementById("outputBox").innerHTML =
            `<p style="color:red;">❌ Error: ${err.message}</p>`;
          document.getElementById("downloadBtn").style.display = "none";
        }
      }

      function downloadWallet() {
        if (!latestWallet) return;
        const text = `
BTC Wallet

Mnemonic:
${latestWallet.mnemonic}

Address:
${latestWallet.address}

Private Key (WIF):
${latestWallet.wif}
`;
        const blob = new Blob([text.trim()], { type: "text/plain" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "btc-wallet.txt";
        a.click();
        URL.revokeObjectURL(url);
      }
    </script>
  </div>
</body>
</html>
